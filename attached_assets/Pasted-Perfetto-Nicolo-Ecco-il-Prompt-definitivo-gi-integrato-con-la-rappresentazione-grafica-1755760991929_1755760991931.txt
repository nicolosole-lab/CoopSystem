Perfetto Nicoloâ€™ ğŸ¯  
Ecco il **Prompt definitivo** giÃ  integrato con la rappresentazione **grafica in mermaid** del flusso, cosÃ¬ su Replit avrai sia le istruzioni testuali passoâ€‘passo che il diagramma da poter visualizzare.

---

## ğŸ§ª Prompt â€” Piano di verifica integritÃ  dati (2019â€‘2025)

**Scopo**  
Eseguire una verifica completa tra i dati contenuti nei file Excel originali e quelli nel database, analizzando anno per anno e mese per mese, con controlli su **tutti i campi specificati**, ricerca di **duplicati** e **dati mancanti**, e analisi delle **cause probabili**.

---

### ğŸ“Œ Contesto
- Excel come fonte di veritÃ , DB = dati importati.
- Possibili differenze di formati, accenti, maiuscole/minuscole.
- Matching gerarchico: `externalId` â†’ `syntheticId` â†’ combinazione `(client_id, staff_id, scheduled_start_time)`.
- Tolleranza temporale: Â±5 minuti.

---

### ğŸ“‹ Tabelle e campi da verificare

**1. `clients`**  
- `id` *(PK)*  
- `external_id`  
- `synthetic_id`  
- `first_name`  
- `last_name`  
- `fiscal_code`  
- `date_of_birth`  
- `created_at`  
- `updated_at`

**2. `staff`**  
- `id` *(PK)*  
- `external_id`  
- `synthetic_id`  
- `first_name`  
- `last_name`  
- `role`  
- `created_at`  
- `updated_at`

**3. `time_logs`**  
- `id` *(PK)*  
- `external_identifier`  
- `client_id` *(FK â†’ clients.id)*  
- `staff_id` *(FK â†’ staff.id)*  
- `scheduled_start_time`  
- `scheduled_end_time`  
- `service_type` / `service_name`  
- `status`  
- `created_at`  
- `updated_at`

---

### ğŸ” Procedura

1. **Raccolta file Excel** (organizzare per anno/mese)  
2. **Preparazione dati** (normalizzazione formati e testi)  
3. **Estrazione dati DB** (tutti i campi sopra indicati)  
4. **Matching record** (prioritÃ  `externalId`, poi `syntheticId`, poi combinazione chiave)  
5. **Confronto campo per campo** (regole di normalizzazione, tolleranze temporali, margini numerici)  
6. **Verifica completezza** (conteggio attesi vs presenti)  
7. **Check duplicati** (stessi ID o combinazione chiave)  
8. **Check dati mancanti** (campi obbligatori nulli o vuoti)  
9. **Analisi cause** (duplicati: reâ€‘import, vincoli assenti; mancanti: formati errati, validazioni assenti)  
10. **Report anomalie** (anno, mese, tabella, campo, valori, tipo anomalia, causa stimata)  
11. **Reporting finale** (% integritÃ , % duplicati, % mancanti, pattern ricorrenti)

---

### ğŸ“Š Output atteso
- Report dettagliato e riepilogativo  
- Statistiche per tabella/campo  
- Nessuna modifica ai dati o al codice

---

### ğŸ–¼ Diagramma di flusso (mermaid)

```mermaid
flowchart TD
    A[Inizio] --> B[ğŸ“‚ Raccolta file Excel<br/>Organizzazione per anno/mese]
    B --> C[ğŸ§¹ Preparazione dati Excel<br/>Normalizzazione formati e testi]
    C --> D[ğŸ’¾ Estrazione dati DB<br/>Tabelle e campi specificati]
    D --> E[ğŸ”— Matching record<br/>externalId â†’ syntheticId â†’ combinazione chiave]
    E --> F[âš–ï¸ Confronto campo per campo<br/>Regole di normalizzazione e tolleranze]
    F --> G[ğŸ“Š Verifica completezza<br/>Conteggio attesi vs trovati]
    G --> H[ğŸ” Check duplicati<br/>ID o combinazione chiave]
    H --> I[ğŸ” Check dati mancanti<br/>Campi obbligatori nulli/vuoti]
    I --> J{Anomalie trovate}
    J -->|SÃ¬| K[ğŸ“ Classificazione<br/>Duplicati, mancanti, incoerenti]
    K --> L[ğŸ§  Analisi cause probabili]
    L --> M[ğŸ“‘ Report finale<br/>% integritÃ , % duplicati, % mancanti]
    J -->|No| M
    M --> N[Fine]
```

---

Vuoi che ti prepari anche **la checklist operativa in formato testo** pronta da copiare/incollare su Replit come guida interattiva per spuntare ogni passo? Sarebbe il complemento perfetto di questo schema.